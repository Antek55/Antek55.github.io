<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="rower-style.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.2"></script>
    <link rel="icon" href="gfx/favicon.ico">
  </head>
  <body>    
    <div class="testbox">
      <form v-on:submit.prevent="submit">
        <div v-if="form_id.length == 0" style="font-size: 60px; color: red">Formularz nieważny, nieustawiony id</div>
        <div v-if="Date.now() > Date.parse(closing)">Ten formularz jest już zamknięty i nie można wysyłać zgłoszeń/odpowiedzi. Napisz bezpośrednio do organizatorów danego zdarzenia / ankiety, żeby dowiedzieć się, czy istnieją wciąż wolne miejsca.</div>
        
        <div v-if="Date.now() <= Date.parse(closing)">
        
          <div class="banner" style='background: linear-gradient(90deg, rgba(2,0,36,1) 0%, rgba(91,208,237,1) 45%, rgba(121,132,255,1) 100%);; '>
            <h1>{{ title }}</h1>
          </div>
          
          <div class="opis">
            <p><i>"On human nature"</i> to klasyczna filozoficzno-metodologiczno-naukoznawczo-społeczno-polityczno-ogólnointelektualna wielowątkowa debata między dwoma intelektualistami-celebrytami, Michelem Foucaultem oraz Noamem Chomskym, która odbyła się w 1971 roku i warto posłuchać jej chociaż raz w życiu. Jeśli masz ochotę wspólnie obejrzeć i ew. skomentować ją na cyfrowokomunikacyjnym audiowizualnym posiedzeniu, określ swoją dostępność w zaproponowanych terminach poniżej.</p>
          </div>
          
          <div class="item">
            <label for="name">Jak się nazywasz?</label>
            <div class="item">
              <input id="name" v-model="name" class="cl" type="text" name="name" placeholder="Imię i nazwisko/rozpoznawalny pseudonim…" required />
            </div>
          </div>
          
          <div class="question">
            <label>Czy masz ochotę obejrzeć debatę Foucualt - Chomsky?</label>
            <div class="question-answer">
              <div>
                <input type="radio" value="tak" v-model="czy" id="radio_1" checked/>
                <label for="radio_1" class="radio"><span>Tak</span></label>
              </div>
              <div>
                <input type="radio" value="nie" v-model="czy" id="radio_2" />
                <label for="radio_2" class="radio"><span>Nie</span></label>
              </div>
            </div>
          </div>
          
          <div class="autogenerated-checkbox-list" v-if="czy == 'tak'">
            <label>Które z poniższych terminów są dla Ciebie odpowiednie?</label>
            <p v-for="[key, value] of Object.entries(r)">
             <input type="checkbox" v-model="r[key]" :id="key" :name="key"> <label :for="key" style="position: relative; left: 15px">{{  key  }}</label>
            </p>
          </div>
      
          <div class="item">
              <label for="uwagi">Czy masz jakieś dodatkowe informacje/uwagi/sugestie/pomysły/objaśnienia/pytania/obawy?</label>
              <textarea id="uwagi" rows="3" v-model="uwagi"></textarea>
          </div>
          
          <div class="btn-block">
            <button>Wyślij</button>
          </div>
        </div>        
      </form>
  </body>
  
  <script>
  function submit_send()
  {
    $("form").html("Proszę o cierpliwość, trwa przesyłanie…")    

    url = 'https://ee3bdbc49df06c2b49c9d45c8834f47c.m.pipedream.net?odp='
    
    var wynik = encodeURIComponent(JSON.stringify(app.$data));
    $.get(url + wynik, on_success);
    
    function on_success(data)
    {
      if (!data.success)
      {
        $("form").html('<h2 class="red">Nie można przesłać z powodu nieznanego błędu. Spróbuj jeszcze raz lub zadeklaruj uczestnictwo osobiście przez wiadomość prywatną/<a href="mailto:ja.wodzinski@student.uw.edu.pl">email</a>.</h2>');
        return false;
      }
      
      $("form").html("Wysłano odpowiedź.")
    }
  }

  var app = new Vue({
    el: "form", 
    data: {
      form_id: "debata-fc-46f2b9",
      title: "Debata Foucault-Chomsky :: określenie dostępności",
      closing: "2021-06-30 22:05",
      name: "",
      czy: "tak",
      r: {
        'wt 20 lipca g. 21:05': false,
        'śr 21 lipca g. 21:05': false,
        'cz 22 lipca g. 21:05': false,
        'pt 23 lipca g. 21:05': false,
        'nd 25 lipca g. 21:05': false,
        'wt 27 lipca g. 21:05': false,
      },
      uwagi: "",
    }, 
    methods: 
    {
      submit: submit_send,
    } 
  })
  
  $("title").html(app.$data.title);
</script>
</html>
