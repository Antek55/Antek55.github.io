<meta charset="utf-8">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://unpkg.com/openpgp@5.0.0-3/dist/openpgp.min.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/npm/openpgp@5.0.0-3/dist/node/openpgp.min.js"></script> -->
<head>
  <title>Wakacje 2021</title>
  <link rel="icon" href="gfx/favicon.ico">
  
  <!-- <script src="snowstorm.js"></script> -->
  <!-- <script> -->
    <!-- snowStorm.followMouse = false; -->
    <!-- snowStorm.freezeOnBlur = false; -->
  <!-- </script> -->
  <style>
    body {
      background-color: #1abc9c;
    }
  </style>
</head>

<div id="loading">Ładowanie…</div>
<iframe srcdoc="" width="100%" height="100%" frameborder="0" style="display:none"></iframe>

<script>
  var searchParams = new URLSearchParams(window.location.search);
  var rid = searchParams.get('r');
  var key = searchParams.get('k');
  var clid = searchParams.get('j');
  
  var isSafari = /constructor/i.test(window.HTMLElement) || (function (p) { return p.toString() === "[object SafariRemoteNotification]"; })(!window['safari'] || (typeof safari !== 'undefined' && window['safari'].pushNotification));
  
  if (isSafari)
  {
    $("#loading").html("Przeglądarka Safari nie potrafi załadować tej strony. Zainstaluj porządną przeglądarkę (np. Mozilla Firefox)");
    throw new Error("Safari not supported");
  }
  
  $.get(rid, "", onload1, "text");
  
  function onload1(data)
  {
      var promise = openpgp.readMessage({armoredMessage: data});
      
      function done1 (value)
      {
        $("iframe").attr("srcdoc", value.data); 
        $("#loading").hide(); 
        $("iframe").show();
        $("iframe").focus();
        
        var title = value.data.match(/<title>(.*)<\/title>/)[1];
        $("title").html(title);
        
        var rids = ["j8jx3G3lAPG", "L6Fu8JtSkRc", "JbJ9TJFAqVM", "vE52Xgh7iRw", "qhYiNl6tvaF"]
        
        if (rids.includes(rid)) {
          $("body").css("background", "darkgreen");
        }
      }
      
      promise.then((value) => openpgp.decrypt({passwords: key, message: value}).then(done1));
  }
</script>
